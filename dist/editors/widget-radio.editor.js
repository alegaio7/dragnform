import functions from"../functions.js";import WidgetCommonPropertiesEditor from"./widget-common.editor.js";export default class WidgetRadioPropertiesEditor extends WidgetCommonPropertiesEditor{constructor(t){super(t),this._radioOptions=t.widget.radioOptions,this._savedRadioOptions=[...t.widget.radioOptions],this.chkHorizontalDisposition=this._dialogContainer.querySelector("#chkWidgetPropRadioHorizontal");var i=this;this.chkHorizontalDisposition&&this._callbacks.onHorizontalDispositionChanged&&this.chkHorizontalDisposition.addEventListener("change",(function(){i._callbacks.onHorizontalDispositionChanged(i,i.widget,this.checked)})),this._setupRadioOptions(),this._setupOrderButtons(),this._dialogContainer.querySelector('[data-action="add"]').addEventListener("click",(t=>{var i=this._addRadioOption(),e=functions.uuidv4();i.setAttribute("data-id",e),this._radioOptions.push({id:e,title:"",value:""}),this._setupOrderButtons(),this._callbacks.onRadioOptionsChanged&&this._callbacks.onRadioOptionsChanged(this,this.widget,this._radioOptions)}))}init(){super.init(),this._updateControls()}_addRadioOption(t,i){t||(t=this._radioOptions.length+1);var e=this._dialogContainer.querySelector('[data-part="radio-options-container"]'),a=e.querySelector('.widget-radio-option[data-index="1"]').cloneNode(!0);a.setAttribute("data-index",t),a.setAttribute("data-id",""),i&&a.setAttribute("data-id",i.id);let o=a.querySelector('[data-part="radio-title"]');o.setAttribute("id",`txtRadioOptionTitle${t}`),o.value=i?i.title:"";let d=a.querySelector('[data-part="radio-value"]');return d.setAttribute("id",`txtRadioOptionValue${t}`),d.value=i?i.value:"",a.querySelector('[data-action="remove"]').classList.remove("widget-hide"),e.appendChild(a),this._attachHandlers(a),a}_attachHandlers(t){t.querySelector('[data-action="remove"]').addEventListener("click",(i=>{if(confirm(Strings.WidgetEditor_Radio_Confirm_Remove_Option_Message)){t.remove();let i=t.getAttribute("data-id");for(var e=0;e<this._radioOptions.length;e++)if(this._radioOptions[e].id===i){this._radioOptions.splice(e,1);break}this._callbacks.onRadioOptionsChanged&&this._callbacks.onRadioOptionsChanged(this,this.widget,this._radioOptions)}}));for(var i=["change","input"],e=0;e<i.length;e++)t.querySelector('[data-part="radio-title"]').addEventListener(i[e],(i=>{if(this._callbacks.onRadioOptionTitleChanged){let e=t.getAttribute("data-id");this._radioOptions.find((t=>t.id===e)).title=i.target.value,this._callbacks.onRadioOptionTitleChanged(this,this.widget,i.target.value,e)}})),t.querySelector('[data-part="radio-value"]').addEventListener(i[e],(i=>{if(this._callbacks.onRadioOptionValueChanged){let e=t.getAttribute("data-id");this._radioOptions.find((t=>t.id===e)).value=i.target.value,this._callbacks.onRadioOptionValueChanged(this,this.widget,i.target.value,e)}}));t.querySelector('[data-action="move-up"]').addEventListener("click",(i=>{this._moveRadioOption(t,-1)})),t.querySelector('[data-action="move-down"]').addEventListener("click",(i=>{this._moveRadioOption(t,1)}))}_cancelDialogHandler(){super._cancelDialogHandler(),this.widget.radioOptions=this._savedRadioOptions}_moveRadioOption(t,i){var e,a,o,d=this._dialogContainer.querySelector('[data-part="radio-options-container"]'),r=d.querySelectorAll(".widget-radio-option"),s=parseInt(t.getAttribute("data-index")),n=s+i;n<1||n>r.length||(i>0?(e=t,a=d.querySelector(`.widget-radio-option[data-index="${n}"]`)):(e=d.querySelector(`.widget-radio-option[data-index="${n}"]`),a=t),d.insertBefore(a,e),o=this._radioOptions[s-1],this._radioOptions[s-1]=this._radioOptions[n-1],this._radioOptions[n-1]=o,this._setupOrderButtons(),this._callbacks.onRadioOptionsChanged&&this._callbacks.onRadioOptionsChanged(this,this.widget,this._radioOptions))}_setupOrderButtons(){for(var t=this._dialogContainer.querySelectorAll('[data-part="radio-options-container"] .widget-radio-option'),i=0;i<t.length;i++){var e=t[i];e.setAttribute("data-index",i+1);var a=e.querySelector('[data-action="move-up"]'),o=e.querySelector('[data-action="move-down"]');a.removeAttribute("disabled"),o.removeAttribute("disabled");let d=e.querySelector('[data-action="remove"]');d.classList.remove("widget-hide"),0==i&&a.setAttribute("disabled","disabled"),i==t.length-1&&o.setAttribute("disabled","disabled"),i<2&&d.classList.add("widget-hide")}}_setupRadioOptions(){for(var t=this._dialogContainer.querySelector('[data-part="radio-options-container"]'),i=0;i<this._radioOptions.length;i++){var e=i+1;if(e<=2){var a=this._radioOptions[i];let o=t.querySelector(`.widget-radio-option[data-index="${e}"]`);o.setAttribute("data-id",a.id),o.querySelector('[data-part="radio-title"]').value=this._radioOptions[i].title,o.querySelector('[data-part="radio-value"]').value=this._radioOptions[i].value,o.querySelector('[data-action="remove"]').classList.add("widget-hide"),this._attachHandlers(o)}else this._addRadioOption(e,this._radioOptions[i])}}}