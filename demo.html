<html>
    <head>
        <title>Demo</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
        <!-- <link href="bootstrap.css" rel="stylesheet"> -->
        <link href="widgets.css" rel="stylesheet">
        <script src="Sortable.min.js"></script>
    </head>
    <body>
        <div class="widget-container border"></div>
        <script type="module">
            import Renderer from './renderer.js';
            import * as constants from './constants.js';
            var renderer = new Renderer();
            var c = document.querySelector(".widget-container");
            fetch('./demo.json')
                .then((response) => response.json())
                .then((json) => {
                    var options = {
                        nullValue: '(null)',
                        renderGrip: true,
                        renderTips: true,
                        renderMode: constants.WIDGET_MODE_DESIGN,
                    };
                    renderer.renderForm(c, json, options)

                    var widgets = renderer.widgets;
                    var submit = renderer.findWidget('submit');
                    if (submit)
                        submit.registerClick(e => { 
                            /*
                            var val = htmlToPdfmake(document.querySelector('.widget-container').innerHTML);
                            var dd = {content:val};
                            pdfMake.createPdf(dd).download();
                            */

                            /*
                            const { jsPDF } = window.jspdf;
                            const doc = new jsPDF({ unit: 'pt' }) // create jsPDF object
                            const pdfElement = document.querySelector('.widget-container') // HTML element to be converted to PDF

                            doc.html(pdfElement, {
                                callback: (pdf) => {
                                pdf.save('file.pdf')
                                },
                                margin: 32, // optional: page margin
                                // optional: other HTMLOptions
                            })
                            */

                            var r = renderer.validate({showErrors: true});
                            if (r.result) {
                                alert('Form is valid!'); 
                                options.renderMode = options.renderMode === constants.WIDGET_MODE_DESIGN ? constants.WIDGET_MODE_VIEW : constants.WIDGET_MODE_DESIGN;
                                renderer.renderForm(c, json, options);
                            }
                        });
                });
        </script>
    </body>
</html>